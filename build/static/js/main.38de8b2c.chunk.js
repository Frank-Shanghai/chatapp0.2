(this["webpackJsonpchatapp0.2"]=this["webpackJsonpchatapp0.2"]||[]).push([[0],{12:function(e,t,a){e.exports=a(20)},20:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(9),s=a.n(i),c=a(1),o=a(2),h=a(4),u=a(3),l=a(5),d=a(6),m=a.n(d),g=a(10),E={ActionTypes:a.n(g)()({CLICK_THREAD:null,CREATE_MESSAGE:null,RECEIVE_RAW_CREATED_MESSAGE:null,RECEIVE_RAW_MESSAGES:null})},v=E.ActionTypes,f=function(e){m.a.dispatch({type:v.CLICK_THREAD,threadID:e})},p=a(11),C=a.n(p),y=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(h.a)(this,Object(u.a)(t).call(this,e)))._onClick=function(){f(a.props.thread.id)},a}return Object(l.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this.props.thread,t=e.lastMessage;return r.a.createElement("li",{className:C()({"thread-list-item":!0,active:e.id==this.props.currentThreadID}),onClick:this._onClick},r.a.createElement("h5",{className:"thread-name"},e.name),r.a.createElement("div",{className:"thread-time"},t.date.toLocaleTimeString()),r.a.createElement("div",{className:"thread-last-message"},t.text))}}]),t}(r.a.Component),D=a(7),A=a.n(D),I=function(e,t){return{id:e.id,threadID:e.threadID,authorName:e.authorName,date:new Date(e.timestamp),text:e.text,isRead:e.threadID===t}},k=function(e,t){var a=Date.now();return{id:"m_"+a,threadID:t,authorName:"Bill",date:new Date(a),text:e,isRead:!0}},_=E.ActionTypes,T=new(function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(h.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).currentID=null,a.threads={},a.dispatchToken=null,a.addChangeListener=function(e){a.on("change",e)},a.removeChangeListener=function(e){a.removeListener("change",e)},a}return Object(l.a)(t,e),Object(o.a)(t,[{key:"init",value:function(e){var t=this;if(e.forEach((function(e){var a=e.threadID,n=t.threads[a];n&&n.lastTimestamp>e.timestamp||(t.threads[a]={id:a,name:e.threadName,lastTimestamp:e.timestamp,lastMessage:I(e,t.currentID)})})),!this.currentID){var a=this.getAllChrono();this.currentID=a[a.length-1].id}this.threads[this.currentID].lastMessage.isRead=!0}},{key:"emitChange",value:function(){this.emit("change")}},{key:"get",value:function(e){return this.threads[e]}},{key:"getAll",value:function(){return this.threads}},{key:"getAllChrono",value:function(){var e=[];for(var t in this.threads){var a=this.threads[t];e.push(a)}return e.sort((function(e,t){return e.lastMessage.date<t.lastMessage.date?-1:e.lastMessage.date>t.lastMessage.date?1:0})),e}},{key:"getCurrentID",value:function(){return this.currentID}},{key:"getCurrent",value:function(){return this.get(this.getCurrentID())}}]),t}(A.a.EventEmitter));T.dispatchToken=m.a.register((function(e){switch(e.type){case _.CLICK_THREAD:T.currentID=e.threadID,T.threads[T.currentID].lastMessage.isRead=!0,T.emitChange();break;case _.RECEIVE_RAW_MESSAGES:T.init(e.rawMessages),T.emitChange()}}));var b=T,S=E.ActionTypes,w={},N=new(function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(h.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).dispatchToken=null,a.getAllForCurrentThread=function(){return a.getAllForThread(b.getCurrentID())},a}return Object(l.a)(t,e),Object(o.a)(t,[{key:"addMessages",value:function(e){e.forEach((function(e){w[e.id]||(w[e.id]=I(e,b.getCurrentID()))}))}},{key:"markAllInThreadRead",value:function(e){for(var t in w)w[t].threadID==e&&(w[t].isRead=!0)}},{key:"emitChange",value:function(){this.emit("change")}},{key:"addChangeListener",value:function(e){this.on("change",e)}},{key:"removeChangeListener",value:function(e){this.removeListener("change",e)}},{key:"get",value:function(e){return w[e]}},{key:"getAll",value:function(){return w}},{key:"getAllForThread",value:function(e){var t=[];for(var a in w)w[a].threadID===e&&t.push(w[a]);return t.sort((function(e,t){return e.date<t.date?-1:e.date>t.date?1:0})),t}}]),t}(A.a.EventEmitter));N.dispatchToken=m.a.register((function(e){switch(e.type){case S.CLICK_THREAD:m.a.waitFor([b.dispatchToken]),N.markAllInThreadRead(b.getCurrentID()),N.emitChange();break;case S.CREATE_MESSAGE:var t=k(e.text,e.currentThreadID);w[t.id]=t,N.emitChange();break;case S.RECEIVE_RAW_MESSAGES:N.addMessages(e.rawMessages),m.a.waitFor([b.dispatchToken]),N.markAllInThreadRead(b.getCurrentID()),N.emitChange()}}));var O=N,j=new(function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(h.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).ActionTypes=E.ActionTypes,a.CHANGE_EVENT="change",a.dispatchToken=null,a}return Object(l.a)(t,e),Object(o.a)(t,[{key:"emitChange",value:function(){this.emit(this.CHANGE_EVENT)}},{key:"addChangeListener",value:function(e){this.on(this.CHANGE_EVENT,e)}},{key:"removeChangeListener",value:function(e){this.removeListener(this.CHANGE_EVENT,e)}},{key:"getCount",value:function(){var e=b.getAll(),t=0;for(var a in e)e[a].lastMessage.isRead||t++;return t}}]),t}(A.a.EventEmitter));j.dispatchToken=m.a.dispatch((function(e){switch(m.a.waitFor([b.dispatchToken,O.dispatchToken]),e.type){case j.ActionTypes.CLICK_THREAD:case j.ActionTypes.RECEIVE_RAW_MESSAGES:j.emitChange()}}));var R=j,M=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(h.a)(this,Object(u.a)(t).call(this,e))).getStateFromStores=function(){return{threads:b.getAllChrono(),currentThreadID:b.getCurrentID(),unreadCount:R.getCount()}},a._onChange=function(){a.setState(a.getStateFromStores())},a.state=a.getStateFromStores(),a}return Object(l.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){b.addChangeListener(this._onChange),R.addChangeListener(this._onChange)}},{key:"componentWillUnmount",value:function(){b.removeChangeListener(this._onChange),R.removeChangeListener(this._onChange)}},{key:"render",value:function(){var e=this,t=this.state.threads.map((function(t){return r.a.createElement(y,{key:t.id,thread:t,currentThreadID:e.state.currentThreadID})}),this),a=0==this.state.unreadCount?null:r.a.createElement("span",null,"Unread threads: ",this.state.unreadCount);return r.a.createElement("div",{className:"thread-section"},r.a.createElement("div",{className:"thread-count"},a),r.a.createElement("ul",{className:"thread-list"},t))}}]),t}(r.a.Component),L=function(e){function t(){return Object(c.a)(this,t),Object(h.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"chatapp"},r.a.createElement(M,null))}}]),t}(r.a.Component),x=function(){localStorage.clear(),localStorage.setItem("messages",JSON.stringify([{id:"m_1",threadID:"t_1",threadName:"Jing and Bill",authorName:"Bill",text:"Hey Jing, want to give a Flux talk at ForwardJS?",timestamp:Date.now()-99999},{id:"m_2",threadID:"t_1",threadName:"Jing and Bill",authorName:"Bill",text:"Seems like a pretty cool conference.",timestamp:Date.now()-89999},{id:"m_3",threadID:"t_1",threadName:"Jing and Bill",authorName:"Jing",text:"Sounds good.  Will they be serving dessert?",timestamp:Date.now()-79999},{id:"m_4",threadID:"t_2",threadName:"Dave and Bill",authorName:"Bill",text:"Hey Dave, want to get a beer after the conference?",timestamp:Date.now()-69999},{id:"m_5",threadID:"t_2",threadName:"Dave and Bill",authorName:"Dave",text:"Totally!  Meet you at the hotel bar.",timestamp:Date.now()-59999},{id:"m_6",threadID:"t_3",threadName:"Functional Heads",authorName:"Bill",text:"Hey Brian, are you going to be talking about functional stuff?",timestamp:Date.now()-49999},{id:"m_7",threadID:"t_3",threadName:"Bill and Brian",authorName:"Brian",text:"At ForwardJS?  Yeah, of course.  See you there!",timestamp:Date.now()-39999}]))},B=a(6),F=E.ActionTypes,G=new(function(){function e(){Object(c.a)(this,e)}return Object(o.a)(e,[{key:"receiveAll",value:function(e){B.dispatch({type:F.RECEIVE_RAW_MESSAGES,rawMessages:e})}},{key:"receiveCreatedMessage",value:function(e){B.dispatch({type:F.RECEIVE_RAW_CREATED_MESSAGE,rawMessage:e})}}]),e}()),H=function(){var e=JSON.parse(window.localStorage.getItem("messages"));G.receiveAll(e)};x(),H(),s.a.render(r.a.createElement(L,null),document.getElementById("react"))},6:function(e,t,a){var n=a(17).Dispatcher;e.exports=new n}},[[12,1,2]]]);
//# sourceMappingURL=main.38de8b2c.chunk.js.map