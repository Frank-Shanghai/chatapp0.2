(this["webpackJsonpchatapp0.2"]=this["webpackJsonpchatapp0.2"]||[]).push([[0],{12:function(e,t,a){e.exports=a(21)},20:function(e,t,a){},21:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(8),i=a.n(s),o=a(1),c=a(2),h=a(4),u=a(3),l=a(5),m=a(6),d=a.n(m),g=a(10),f={ActionTypes:a.n(g)()({CLICK_THREAD:null,CREATE_MESSAGE:null,RECEIVE_RAW_CREATED_MESSAGE:null,RECEIVE_RAW_MESSAGES:null})},v=f.ActionTypes,E=function(e){d.a.dispatch({type:v.CLICK_THREAD,threadID:e})},p=a(11),C=a.n(p),y=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(h.a)(this,Object(u.a)(t).call(this,e)))._onClick=function(){E(a.props.thread.id)},a}return Object(l.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.thread,t=e.lastMessage;return r.a.createElement("li",{className:C()({"thread-list-item":!0,active:e.id==this.props.currentThreadID}),onClick:this._onClick},r.a.createElement("h5",{className:"thread-name"},e.name),r.a.createElement("div",{className:"thread-time"},t.date.toLocaleTimeString()),r.a.createElement("div",{className:"thread-last-message"},t.text))}}]),t}(r.a.Component),D=a(7),I=a.n(D),k=function(e,t){return{id:e.id,threadID:e.threadID,authorName:e.authorName,date:new Date(e.timestamp),text:e.text,isRead:e.threadID===t}},A=function(e,t){var a=Date.now();return{id:"m_"+a,threadID:t,authorName:"Bill",date:new Date(a),text:e,isRead:!0}},T=f.ActionTypes,b=new(function(e){function t(){var e,a;Object(o.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(h.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).currentID=null,a.threads={},a.dispatchToken=null,a.addChangeListener=function(e){a.on("change",e)},a.removeChangeListener=function(e){a.removeListener("change",e)},a}return Object(l.a)(t,e),Object(c.a)(t,[{key:"init",value:function(e){var t=this;if(e.forEach((function(e){var a=e.threadID,n=t.threads[a];n&&n.lastTimestamp>e.timestamp||(t.threads[a]={id:a,name:e.threadName,lastTimestamp:e.timestamp,lastMessage:k(e,t.currentID)})})),!this.currentID){var a=this.getAllChrono();this.currentID=a[a.length-1].id}this.threads[this.currentID].lastMessage.isRead=!0}},{key:"emitChange",value:function(){this.emit("change")}},{key:"get",value:function(e){return this.threads[e]}},{key:"getAll",value:function(){return this.threads}},{key:"getAllChrono",value:function(){var e=[];for(var t in this.threads){var a=this.threads[t];e.push(a)}return e.sort((function(e,t){return e.lastMessage.date<t.lastMessage.date?-1:e.lastMessage.date>t.lastMessage.date?1:0})),e}},{key:"getCurrentID",value:function(){return this.currentID}},{key:"getCurrent",value:function(){return this.get(this.getCurrentID())}}]),t}(I.a.EventEmitter));b.dispatchToken=d.a.register((function(e){switch(e.type){case T.CLICK_THREAD:b.currentID=e.threadID,b.threads[b.currentID].lastMessage.isRead=!0,b.emitChange();break;case T.RECEIVE_RAW_MESSAGES:b.init(e.rawMessages),b.emitChange()}}));var S=b,_=f.ActionTypes,O=new(function(e){function t(){var e,a;Object(o.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(h.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).messages={},a.dispatchToken=null,a.getAllForCurrentThread=function(){return a.getAllForThread(S.getCurrentID())},a}return Object(l.a)(t,e),Object(c.a)(t,[{key:"addMessages",value:function(e){var t=this;e.forEach((function(e){t.messages[e.id]||(t.messages[e.id]=k(e,S.getCurrentID()))}))}},{key:"markAllInThreadRead",value:function(e){for(var t in this.messages)this.messages[t].threadID==e&&(this.messages[t].isRead=!0)}},{key:"emitChange",value:function(){this.emit("change")}},{key:"addChangeListener",value:function(e){this.on("change",e)}},{key:"removeChangeListener",value:function(e){this.removeListener("change",e)}},{key:"get",value:function(e){return this.messages[e]}},{key:"getAll",value:function(){return this.messages}},{key:"getAllForThread",value:function(e){var t=[];for(var a in this.messages)this.messages[a].threadID===e&&t.push(this.messages[a]);return t.sort((function(e,t){return e.date<t.date?-1:e.date>t.date?1:0})),t}}]),t}(I.a.EventEmitter));O.dispatchToken=d.a.register((function(e){switch(e.type){case _.CLICK_THREAD:d.a.waitFor([S.dispatchToken]),O.markAllInThreadRead(S.getCurrentID()),O.emitChange();break;case _.CREATE_MESSAGE:var t=A(e.text,e.currentThreadID);O.messages[t.id]=t,O.emitChange();break;case _.RECEIVE_RAW_MESSAGES:O.addMessages(e.rawMessages),d.a.waitFor([S.dispatchToken]),O.markAllInThreadRead(S.getCurrentID()),O.emitChange()}}));var N=O,j=new(function(e){function t(){var e,a;Object(o.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(h.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).ActionTypes=f.ActionTypes,a.CHANGE_EVENT="change",a.dispatchToken=null,a}return Object(l.a)(t,e),Object(c.a)(t,[{key:"emitChange",value:function(){this.emit(this.CHANGE_EVENT)}},{key:"addChangeListener",value:function(e){this.on(this.CHANGE_EVENT,e)}},{key:"removeChangeListener",value:function(e){this.removeListener(this.CHANGE_EVENT,e)}},{key:"getCount",value:function(){var e=S.getAll(),t=0;for(var a in e)e[a].lastMessage.isRead||t++;return t}}]),t}(I.a.EventEmitter));j.dispatchToken=d.a.dispatch((function(e){switch(d.a.waitFor([S.dispatchToken,N.dispatchToken]),e.type){case j.ActionTypes.CLICK_THREAD:case j.ActionTypes.RECEIVE_RAW_MESSAGES:j.emitChange()}}));var w=j,R=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(h.a)(this,Object(u.a)(t).call(this,e))).getStateFromStores=function(){return{threads:S.getAllChrono(),currentThreadID:S.getCurrentID(),unreadCount:w.getCount()}},a._onChange=function(){a.setState(a.getStateFromStores())},a.state=a.getStateFromStores(),a}return Object(l.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){S.addChangeListener(this._onChange),w.addChangeListener(this._onChange)}},{key:"componentWillUnmount",value:function(){S.removeChangeListener(this._onChange),w.removeChangeListener(this._onChange)}},{key:"render",value:function(){var e=this,t=this.state.threads.map((function(t){return r.a.createElement(y,{key:t.id,thread:t,currentThreadID:e.state.currentThreadID})}),this),a=0==this.state.unreadCount?null:r.a.createElement("span",null,"Unread threads: ",this.state.unreadCount);return r.a.createElement("div",{className:"thread-section"},r.a.createElement("div",{className:"thread-count"},a),r.a.createElement("ul",{className:"thread-list"},t))}}]),t}(r.a.Component),M=a(6),L=f.ActionTypes,x=new(function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,[{key:"receiveAll",value:function(e){M.dispatch({type:L.RECEIVE_RAW_MESSAGES,rawMessages:e})}},{key:"receiveCreatedMessage",value:function(e){M.dispatch({type:L.RECEIVE_RAW_CREATED_MESSAGE,rawMessage:e})}}]),e}()),B=function(){var e=JSON.parse(window.localStorage.getItem("messages"));x.receiveAll(e)},F=function(e,t){var a=JSON.parse(localStorage.getItem("messages")),n=Date.now(),r={id:"m_"+n,threadID:e.threadID||"t_"+Date.now(),threadName:t,authorName:e.authorName,text:e.text,timestamp:n};a.push(r),localStorage.setItem("messages",JSON.stringify(a)),setTimeout((function(){x.receiveCreatedMessage(r)}),0)},G=f.ActionTypes,H=function(e,t){d.a.dispatch({type:G.CREATE_MESSAGE,text:e,currentThreadID:t});var a=A(e,t);F(a)},J=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(h.a)(this,Object(u.a)(t).call(this,e))).ENTER_KEY_CODE=13,a.onChange=function(e,t){a.setState({text:e.target.value})},a.onKeyDown=function(e){if(e.keyCode==a.ENTER_KEY_CODE){e.preventDefault();var t=a.state.text.trim();t&&H(t,a.props.threadID),a.setState({text:""})}},a.state={text:""},a}return Object(l.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("textarea",{className:"message-composer",name:"message",value:this.state.text,onChange:this.onChange,onKeyDown:this.onKeyDown})}}]),t}(r.a.Component),V=function(e){function t(e){return Object(o.a)(this,t),Object(h.a)(this,Object(u.a)(t).call(this,e))}return Object(l.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.message;return r.a.createElement("li",{className:"message-list-item"},r.a.createElement("h5",{className:"message-author-name"},e.authorName),r.a.createElement("div",{className:"message-time"},e.date.toLocaleTimeString()),r.a.createElement("div",{className:"message-text"},e.text))}}]),t}(r.a.Component),K=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(h.a)(this,Object(u.a)(t).call(this,e))).onChange=function(){a.setState(a.getStateFromStores())},a.state=a.getStateFromStores(),a}return Object(l.a)(t,e),Object(c.a)(t,[{key:"getStateFromStores",value:function(){return{messages:N.getAllForCurrentThread(),thread:S.getCurrent()}}},{key:"getMessageListItem",value:function(e){return r.a.createElement(V,{key:e.id,message:e})}},{key:"render",value:function(){var e=this.state.messages.map(this.getMessageListItem);return r.a.createElement("div",{className:"message-section"},r.a.createElement("h3",{className:"message-thread-heading"},this.state.thread.name),r.a.createElement("ul",{className:"message-list",ref:"messageList"},e),r.a.createElement(J,{threadID:this.state.thread.id}))}},{key:"componentDidMount",value:function(){this.scrollToBottom(),N.addChangeListener(this.onChange),S.addChangeListener(this.onChange)}},{key:"componentWillUnmount",value:function(){N.removeChangeListener(this.onChange),S.removeChangeListener(this.onChange)}},{key:"componentDidUpdate",value:function(){this.scrollToBottom()}},{key:"scrollToBottom",value:function(){var e=i.a.findDOMNode(this.refs.messageList);e.scrollTop=e.scrollHeight}}]),t}(r.a.Component),W=(a(20),function(e){function t(){return Object(o.a)(this,t),Object(h.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"chatapp"},r.a.createElement(R,null),r.a.createElement(K,null))}}]),t}(r.a.Component));(function(){localStorage.clear(),localStorage.setItem("messages",JSON.stringify([{id:"m_1",threadID:"t_1",threadName:"Jing and Bill",authorName:"Bill",text:"Hey Jing, want to give a Flux talk at ForwardJS?",timestamp:Date.now()-99999},{id:"m_2",threadID:"t_1",threadName:"Jing and Bill",authorName:"Bill",text:"Seems like a pretty cool conference.",timestamp:Date.now()-89999},{id:"m_3",threadID:"t_1",threadName:"Jing and Bill",authorName:"Jing",text:"Sounds good.  Will they be serving dessert?",timestamp:Date.now()-79999},{id:"m_4",threadID:"t_2",threadName:"Dave and Bill",authorName:"Bill",text:"Hey Dave, want to get a beer after the conference?",timestamp:Date.now()-69999},{id:"m_5",threadID:"t_2",threadName:"Dave and Bill",authorName:"Dave",text:"Totally!  Meet you at the hotel bar.",timestamp:Date.now()-59999},{id:"m_6",threadID:"t_3",threadName:"Functional Heads",authorName:"Bill",text:"Hey Brian, are you going to be talking about functional stuff?",timestamp:Date.now()-49999},{id:"m_7",threadID:"t_3",threadName:"Bill and Brian",authorName:"Brian",text:"At ForwardJS?  Yeah, of course.  See you there!",timestamp:Date.now()-39999}]))})(),B(),i.a.render(r.a.createElement(W,null),document.getElementById("react"))},6:function(e,t,a){var n=a(17).Dispatcher;e.exports=new n}},[[12,1,2]]]);
//# sourceMappingURL=main.60951780.chunk.js.map